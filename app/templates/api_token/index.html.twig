{% extends 'base.html.twig' %}

{% block title %}{{ 'token.title'|trans({}, 'token') }}{% endblock %}

{% block body %}
<div class="ai-dashboard-header mb-4">
    <div class="d-flex justify-content-between align-items-center">
        <div class="d-flex align-items-center">
            <i class="bi bi-key text-neon fs-2 me-3"></i>
            <div>
                <h1 class="text-gradient mb-1">{{ 'token.title'|trans({}, 'token') }}</h1>
                <p class="text-secondary mb-0">{{ 'token.description'|trans({}, 'token') }}</p>
            </div>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-lg-8">
        <!-- Current API Token -->
        <div class="luminai-card p-4 mb-4">
            <h5 class="text-white mb-3">
                <i class="bi bi-shield-check me-2"></i>{{ 'token.current.token'|trans({}, 'token') }}
            </h5>

            {% if user.apiToken and user.isApiTokenValid %}
                <div class="alert alert-success border-0 rounded-3 mb-4" style="background: rgba(34, 197, 94, 0.1); border: 1px solid rgba(34, 197, 94, 0.3) !important; color: #22c55e;">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <i class="bi bi-check-circle me-2"></i>
                            <strong>{{ 'token.active.token'|trans({}, 'token') }}</strong>
                        </div>
                        <span class="badge" style="background: var(--luminai-ai-gradient);">
                            <i class="bi bi-clock me-1"></i>{{ 'token.expires'|trans({}, 'token') }}: {{ user.apiTokenExpiresAt|date('M d, Y') }}
                        </span>
                    </div>
                </div>

                <div class="mb-4">
                    <label class="form-label text-white">{{ 'token.your.token'|trans({}, 'token') }}</label>
                    <div class="input-group">
                        <input
                            type="text"
                            class="form-control font-monospace"
                            id="apiTokenValue"
                            value="{{ user.apiToken }}"
                            readonly
                            style="background: var(--luminai-card-bg); border-color: rgba(255, 255, 255, 0.1); color: white;"
                        >
                        <button class="btn luminai-btn-ai" type="button" onclick="copyToken()">
                            <i class="bi bi-clipboard me-1"></i>{{ 'token.copy'|trans({}, 'token') }}
                        </button>
                    </div>
                    <small class="text-muted">{{ 'token.copy.warning'|trans({}, 'token') }}</small>
                </div>

                <form method="post" action="{{ path('api_token_revoke') }}" onsubmit="return confirm('{{ 'token.revoke.confirm'|trans({}, 'token') }}')">
                    <input type="hidden" name="_token" value="{{ csrf_token('revoke_token') }}">
                    <button type="submit" class="btn btn-danger">
                        <i class="bi bi-x-circle me-2"></i>{{ 'token.revoke'|trans({}, 'token') }}
                    </button>
                </form>
            {% else %}
                <div class="alert alert-warning border-0 rounded-3 mb-4" style="background: rgba(251, 191, 36, 0.1); border: 1px solid rgba(251, 191, 36, 0.3) !important; color: #fbbf24;">
                    <i class="bi bi-exclamation-triangle me-2"></i>{{ 'token.no.active.token'|trans({}, 'token') }}
                </div>

                <form method="post" action="{{ path('api_token_generate') }}">
                    <input type="hidden" name="_token" value="{{ csrf_token('generate_token') }}">
                    <button type="submit" class="btn luminai-btn-primary">
                        <i class="bi bi-plus-circle me-2"></i>{{ 'token.generate'|trans({}, 'token') }}
                    </button>
                </form>
            {% endif %}
        </div>

        <!-- Usage Instructions -->
        <div class="luminai-card p-4">
            <h5 class="text-white mb-3">
                <i class="bi bi-book me-2"></i>{{ 'token.usage.instructions'|trans({}, 'token') }}
            </h5>

            <p class="text-secondary mb-3">{{ 'token.usage.description'|trans({}, 'token') }}</p>

            <div class="bg-dark p-3 rounded mb-3">
                <code class="text-white">
curl -H "Authorization: Bearer YOUR_API_TOKEN" \<br>
     https://localhost/api/users
                </code>
            </div>

            <h6 class="text-neon mb-2">{{ 'token.security.tips'|trans({}, 'token') }}</h6>
            <ul class="text-secondary">
                <li>{{ 'token.tip.1'|trans({}, 'token') }}</li>
                <li>{{ 'token.tip.2'|trans({}, 'token') }}</li>
                <li>{{ 'token.tip.3'|trans({}, 'token') }}</li>
                <li>{{ 'token.tip.4'|trans({}, 'token') }}</li>
            </ul>
        </div>
    </div>

    <!-- Token Info Card -->
    <div class="col-lg-4">
        <div class="luminai-card ai-enhanced p-4 mb-4">
            <div class="d-flex align-items-center mb-3">
                <i class="bi bi-info-circle text-neon me-2 fs-4"></i>
                <h6 class="text-gradient mb-0">{{ 'token.info.title'|trans({}, 'token') }}</h6>
            </div>
            <div class="text-secondary">
                <p class="mb-2"><strong>{{ 'token.validity.period'|trans({}, 'token') }}:</strong> {{ 'token.validity.30.days'|trans({}, 'token') }}</p>
                <p class="mb-2"><strong>{{ 'token.access.level'|trans({}, 'token') }}:</strong> {{ 'token.full.api.access'|trans({}, 'token') }}</p>
                <p class="mb-0"><strong>{{ 'token.regeneration'|trans({}, 'token') }}:</strong> {{ 'token.regeneration.description'|trans({}, 'token') }}</p>
            </div>
        </div>

        <div class="metric-card">
            <i class="bi bi-shield-lock text-neon fs-1"></i>
            <div class="metric-value">{% if user.apiToken %}1{% else %}0{% endif %}</div>
            <div class="metric-label">{{ 'token.active.tokens'|trans({}, 'token') }}</div>
            <div class="metric-trend {% if user.apiToken %}trend-up{% endif %}">
                {% if user.apiToken %}
                    <i class="bi bi-check-circle"></i> {{ 'token.secure'|trans({}, 'token') }}
                {% else %}
                    <i class="bi bi-dash-circle"></i> {{ 'token.no.token'|trans({}, 'token') }}
                {% endif %}
            </div>
        </div>
    </div>
</div>

<script>
function copyToken() {
    const tokenInput = document.getElementById('apiTokenValue');
    tokenInput.select();
    tokenInput.setSelectionRange(0, 99999);
    navigator.clipboard.writeText(tokenInput.value);

    const btn = event.target.closest('button');
    const originalText = btn.innerHTML;
    btn.innerHTML = '<i class="bi bi-check me-1"></i>{{ 'token.copied'|trans({}, 'token') }}';
    btn.classList.add('btn-success');
    btn.classList.remove('luminai-btn-ai');

    setTimeout(() => {
        btn.innerHTML = originalText;
        btn.classList.remove('btn-success');
        btn.classList.add('luminai-btn-ai');
    }, 2000);
}
</script>
{% endblock %}
