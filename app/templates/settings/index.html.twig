{% extends 'base.html.twig' %}

{% block title %}{{ 'settings.title'|trans }} - Infinity{% endblock %}

{% block body %}
<!-- Navigation -->
<div class="mb-4">
    <a href="{{ path('app_home') }}" class="btn infinity-btn-ai">
        <i class="bi bi-arrow-left me-2"></i>{{ 'ui.back.to.dashboard'|trans }}
    </a>
</div>

<!-- Settings Header -->
<div class="ai-dashboard-header mb-4">
    <div class="d-flex align-items-center">
        <i class="bi bi-gear text-neon fs-2 me-3"></i>
        <div>
            <h1 class="text-gradient mb-1">{{ 'settings.title'|trans }}</h1>
            <p class="text-secondary mb-0">{{ 'page.settings.description'|trans }}</p>
        </div>
    </div>
</div>

<!-- Settings Categories -->
<div class="bento-grid">
    <!-- Theme Selection -->
    <div class="bento-item large">
        <div class="infinity-card ai-enhanced p-4 h-100">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h5 class="text-neon mb-0">
                    <i class="bi bi-palette me-2"></i>{{ 'theme.settings'|trans }}
                </h5>
                <div class="ai-status-indicator" id="currentThemeStatus">
                    {{ 'theme.dark'|trans }}
                </div>
            </div>

            <div class="row">
                <!-- Dark Theme -->
                <div class="col-md-6 mb-3">
                    <div class="theme-card" data-theme="dark" id="darkTheme" onclick="switchTheme('dark')">
                        <div class="theme-preview-mini dark-preview-mini">
                            <div class="theme-header"></div>
                            <div class="theme-content">
                                <div class="theme-card-mini"></div>
                                <div class="theme-sidebar-mini"></div>
                            </div>
                        </div>
                        <div class="theme-info p-3">
                            <h6 class="theme-card-title mb-2">
                                <i class="bi bi-moon-stars me-2"></i>{{ 'theme.dark'|trans }}
                            </h6>
                            <p class="text-secondary mb-0" style="font-size: 0.875rem;">{{ 'theme.dark.description'|trans }}</p>
                        </div>
                    </div>
                </div>

                <!-- Light Theme -->
                <div class="col-md-6 mb-3">
                    <div class="theme-card" data-theme="light" id="lightTheme" onclick="switchTheme('light')">
                        <div class="theme-preview-mini light-preview-mini">
                            <div class="theme-header"></div>
                            <div class="theme-content">
                                <div class="theme-card-mini"></div>
                                <div class="theme-sidebar-mini"></div>
                            </div>
                        </div>
                        <div class="theme-info p-3">
                            <h6 class="theme-card-title mb-2">
                                <i class="bi bi-sun me-2"></i>{{ 'theme.light'|trans }}
                            </h6>
                            <p class="text-secondary mb-0" style="font-size: 0.875rem;">{{ 'theme.light.description'|trans }}</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Language Preferences -->
    <div class="bento-item">
        <div class="infinity-card p-4 h-100">
            <div class="mb-4">
                <div class="d-flex align-items-center mb-3">
                    <i class="bi bi-translate text-neon fs-4 me-3"></i>
                    <h5 class="text-white mb-0">{{ 'settings.language.preferences'|trans }}</h5>
                </div>

                <div class="mb-3">
                    <label class="form-label text-secondary">{{ 'settings.current.language'|trans }}:</label>
                    <div class="text-white fw-semibold">{{ ('language.' ~ current_locale)|trans }}</div>
                </div>

                <form method="post" action="{{ path('app_settings_locale') }}" data-controller="form-navigation">
                    <div class="mb-3">
                        <label for="locale" class="form-label text-secondary">{{ 'settings.choose.language'|trans }}:</label>
                        <select name="locale" id="locale" class="form-select" data-preference="locale" style="background: var(--infinity-dark-surface); border: 1px solid rgba(255, 255, 255, 0.2); color: white;" onchange="this.form.submit()">
                            {% for locale_code, locale_name in supported_locales %}
                                <option value="{{ locale_code }}" {{ locale_code == current_locale ? 'selected' : '' }}>
                                    {{ locale_name|trans }}
                                </option>
                            {% endfor %}
                        </select>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- UI Preferences -->
    <div class="bento-item">
        <div class="infinity-card p-4 h-100">
            <div class="mb-4">
                <div class="d-flex align-items-center mb-3">
                    <i class="bi bi-sliders text-neon fs-4 me-3"></i>
                    <h5 class="text-white mb-0">{{ 'settings.ui.preferences'|trans }}</h5>
                </div>

                <div class="space-y-3">
                    <!-- Animations -->
                    <div class="form-check form-switch">
                        <input class="form-check-input" type="checkbox" id="animations_enabled" data-preference="animations_enabled"
                               checked="{{ user_preferences.animations_enabled ? 'checked' : '' }}">
                        <label class="form-check-label text-secondary" for="animations_enabled">
                            {{ 'settings.enable.animations'|trans }}
                        </label>
                    </div>

                    <!-- Sound -->
                    <div class="form-check form-switch">
                        <input class="form-check-input" type="checkbox" id="sound_enabled" data-preference="sound_enabled"
                               checked="{{ user_preferences.sound_enabled ? 'checked' : '' }}">
                        <label class="form-check-label text-secondary" for="sound_enabled">
                            {{ 'settings.enable.sound'|trans }}
                        </label>
                    </div>

                    <!-- Compact Mode -->
                    <div class="form-check form-switch">
                        <input class="form-check-input" type="checkbox" id="compact_mode" data-preference="compact_mode"
                               checked="{{ user_preferences.compact_mode ? 'checked' : '' }}">
                        <label class="form-check-label text-secondary" for="compact_mode">
                            {{ 'settings.compact.mode'|trans }}
                        </label>
                    </div>

                    <!-- Items per page -->
                    <div class="mb-3">
                        <label for="items_per_page" class="form-label text-secondary">{{ 'settings.items.per.page'|trans }}:</label>
                        <select id="items_per_page" class="form-select" data-preference="items_per_page"
                                style="background: var(--infinity-dark-surface); border: 1px solid rgba(255, 255, 255, 0.2); color: white;">
                            <option value="10" {{ user_preferences.items_per_page == 10 ? 'selected' : '' }}>10</option>
                            <option value="25" {{ user_preferences.items_per_page == 25 ? 'selected' : '' }}>25</option>
                            <option value="50" {{ user_preferences.items_per_page == 50 ? 'selected' : '' }}>50</option>
                            <option value="100" {{ user_preferences.items_per_page == 100 ? 'selected' : '' }}>100</option>
                        </select>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- AI Configuration -->
    <div class="bento-item">
        <div class="infinity-card p-4 h-100">
            <div class="text-center mb-4">
                <div class="p-3 rounded-3 mx-auto mb-3" style="background: linear-gradient(135deg, var(--infinity-primary), var(--infinity-secondary)); width: 80px; height: 80px; display: flex; align-items: center; justify-content: center;">
                    <i class="bi bi-robot text-white fs-2"></i>
                </div>
                <h5 class="text-white mb-2">{{ 'ai.settings'|trans }}</h5>
                <p class="text-secondary mb-3">{{ 'ai.settings.description'|trans }}</p>
                <button class="btn infinity-btn-ai" disabled>
                    <i class="bi bi-magic me-2"></i>{{ 'misc.coming.soon'|trans }}
                </button>
            </div>
        </div>
    </div>

    <!-- System Information -->
    <div class="bento-item large">
        <div class="infinity-card p-4 h-100">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h5 class="text-neon mb-0">
                    <i class="bi bi-info-circle me-2"></i>{{ 'system.information'|trans }}
                </h5>
                <div class="ai-status-indicator">
                    {{ 'system.status'|trans }}
                </div>
            </div>

            <div class="row">
                <div class="col-md-3 mb-3">
                    <div class="metric-card">
                        <div class="metric-value" style="font-size: 1.5rem;">v1.0</div>
                        <div class="metric-label">{{ 'system.version'|trans }}</div>
                    </div>
                </div>
                <div class="col-md-3 mb-3">
                    <div class="metric-card">
                        <div class="metric-value" style="font-size: 1.5rem;">PHP 8.4</div>
                        <div class="metric-label">{{ 'system.runtime'|trans }}</div>
                    </div>
                </div>
                <div class="col-md-3 mb-3">
                    <div class="metric-card">
                        <div class="metric-value" style="font-size: 1.5rem;">Symfony 7.3</div>
                        <div class="metric-label">{{ 'system.framework'|trans }}</div>
                    </div>
                </div>
                <div class="col-md-3 mb-3">
                    <div class="metric-card">
                        <div class="metric-value" style="font-size: 1.5rem;">PostgreSQL 18</div>
                        <div class="metric-label">{{ 'system.database'|trans }}</div>
                    </div>
                </div>
            </div>

            <div class="mt-4 p-3 rounded" style="background: rgba(0, 245, 255, 0.05); border: 1px solid rgba(0, 245, 255, 0.2);">
                <div class="d-flex align-items-center">
                    <i class="bi bi-shield-check text-neon me-2"></i>
                    <div>
                        <strong class="text-white">{{ 'system.security.status'|trans }}</strong>
                        <span class="text-secondary ms-2">{{ 'system.security.message'|trans }}</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block javascripts %}
<style>
/* Theme Card Title - Always visible regardless of theme */
.theme-card-title {
    color: #ffffff !important;
}

/* Simple Theme Cards */
.theme-card {
    background: var(--infinity-dark-surface);
    border: 2px solid transparent;
    border-radius: 1rem;
    cursor: pointer;
    transition: all 0.3s ease;
    overflow: hidden;
}

.theme-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
}

.theme-card.active {
    border-color: var(--infinity-neon);
    box-shadow: 0 0 20px rgba(0, 245, 255, 0.3);
}

.theme-preview-mini {
    height: 120px;
    position: relative;
    overflow: hidden;
}

.dark-preview-mini {
    background: linear-gradient(135deg, #0a0a0b 0%, #1a1a2e 50%, #16213e 100%);
}

.light-preview-mini {
    background: linear-gradient(135deg, #ffffff 0%, #f8fafc 50%, #e2e8f0 100%);
}

.theme-header {
    height: 25px;
    margin: 8px;
    border-radius: 4px;
}

.dark-preview-mini .theme-header {
    background: rgba(26, 26, 30, 0.9);
    border-bottom: 1px solid rgba(0, 245, 255, 0.3);
}

.light-preview-mini .theme-header {
    background: rgba(255, 255, 255, 0.9);
    border-bottom: 1px solid rgba(59, 130, 246, 0.3);
}

.theme-content {
    display: flex;
    gap: 8px;
    margin: 8px;
    height: 70px;
}

.theme-card-mini {
    flex-grow: 1;
    border-radius: 6px;
}

.dark-preview-mini .theme-card-mini {
    background: rgba(45, 45, 52, 0.6);
    border: 1px solid rgba(255, 255, 255, 0.1);
}

.light-preview-mini .theme-card-mini {
    background: rgba(255, 255, 255, 0.8);
    border: 1px solid rgba(0, 0, 0, 0.1);
}

.theme-sidebar-mini {
    width: 30px;
    border-radius: 6px;
}

.dark-preview-mini .theme-sidebar-mini {
    background: rgba(79, 70, 229, 0.3);
}

.light-preview-mini .theme-sidebar-mini {
    background: rgba(59, 130, 246, 0.3);
}
</style>

<script>
// Settings page theme management
const SettingsTheme = {
    async init() {
        // Wait for PreferenceManager to load
        await window.PreferenceManager.waitForLoad();

        // Update UI based on current theme from PreferenceManager
        const current = window.PreferenceManager.getUserPreference('theme', 'dark');
        this.updateUI(current);
    },

    updateUI(theme) {
        // Update active state
        document.querySelectorAll('.theme-card').forEach(card => {
            card.classList.remove('active');
        });
        document.getElementById(theme + 'Theme')?.classList.add('active');

        // Update status indicator
        const status = document.getElementById('currentThemeStatus');
        if (status) {
            status.textContent = theme === 'light' ? '{{ 'theme.light'|trans }}' : '{{ 'theme.dark'|trans }}';
        }
    }
};

// Global theme switch function
async function switchTheme(theme) {
    // Save via PreferenceManager (saves to localStorage + database)
    await window.PreferenceManager.setUserPreference('theme', theme);

    // Apply theme globally
    if (typeof GlobalTheme !== 'undefined') {
        GlobalTheme.apply(theme);
        GlobalTheme.updateNavbar();
    } else {
        // Fallback if GlobalTheme not available
        document.documentElement.setAttribute('data-theme', theme);
    }

    // Update local UI
    SettingsTheme.updateUI(theme);

    // Show feedback
    const card = document.getElementById(theme + 'Theme');
    const originalContent = card.querySelector('.theme-info h6').innerHTML;
    card.querySelector('.theme-info h6').innerHTML = '<i class="bi bi-check-circle me-2"></i>Applied!';

    setTimeout(() => {
        card.querySelector('.theme-info h6').innerHTML = originalContent;
    }, 1500);
}

// Initialize when page loads
document.addEventListener('DOMContentLoaded', () => {
    SettingsTheme.init();
});
</script>
{% endblock %}