# Genmax Template Structure - Complete Guide

**Last Updated:** January 2025
**Status:** Fixed and Production-Ready

---

## Overview

Genmax uses a **Base/Extension pattern** for template generation:
- **Generated templates** (`/templates/{{Entity}}/generated/`) - ALWAYS regenerated, never edit
- **Extension templates** (`/templates/{{Entity}}/`) - Created once, safe to customize

---

## File Structure

For an entity called `Contact`, Genmax generates the following structure:

```
app/templates/
├── contact/                                    # Extension folder (user customizable)
│   ├── index.html.twig                        # ✅ EXTENDS generated/index_generated.html.twig
│   ├── show.html.twig                         # ✅ EXTENDS generated/show_generated.html.twig
│   ├── form.html.twig                         # ✅ EXTENDS generated/form_generated.html.twig
│   ├── new.html.twig                          # ✅ EXTENDS generated/new_generated.html.twig
│   ├── edit.html.twig                         # ✅ EXTENDS generated/edit_generated.html.twig
│   └── generated/                             # Generated folder (always regenerated)
│       ├── index_generated.html.twig          # ⚠️ NEVER EDIT - Full implementation
│       ├── show_generated.html.twig           # ⚠️ NEVER EDIT - Full implementation
│       ├── form_generated.html.twig           # ⚠️ NEVER EDIT - Full implementation
│       ├── new_generated.html.twig            # ⚠️ NEVER EDIT - Full implementation
│       └── edit_generated.html.twig           # ⚠️ NEVER EDIT - Full implementation
```

---

## Template Roles

### 1. Generated Templates (`/templates/contact/generated/*.html.twig`)

**Purpose:** Contain the FULL implementation of the template.

**Characteristics:**
- Located in `/templates/{entity}/generated/` folder
- Always regenerated by Genmax
- NEVER edit these files - changes will be lost
- Contains all the logic, loops, blocks, data-binding, etc.

**Example:** `/templates/contact/generated/index_generated.html.twig` (172 lines)
```twig
{% extends '_base_entity_list.html.twig' %}

{# Full implementation with Grid/List/Table views #}

{% block page_icon %}<i class="bi bi-person text-neon fs-2 me-3"></i>{% endblock %}

{% block grid_view_item_template %}
    {# Full grid implementation here #}
{% endblock %}

{% block list_view_item_template %}
    {# Full list implementation here #}
{% endblock %}

{% block table_view_row_template %}
    {# Full table implementation here #}
{% endblock %}
```

---

### 2. Extension Templates (`/templates/contact/*.html.twig`)

**Purpose:** Extend generated templates for customization.

**Characteristics:**
- Located in `/templates/{entity}/` folder (root level)
- Created once - if file exists, Genmax skips it
- Safe to customize
- Contains NO content by default - just extends the generated template
- User can override specific blocks to customize behavior

**Example:** `/templates/contact/index.html.twig` (8 lines - minimal)
```twig
{# Extension template for Contact index page #}
{# This template extends the generated one. Override specific blocks to customize. #}
{# Generated template: contact/generated/index_generated.html.twig #}

{% extends 'contact/generated/index_generated.html.twig' %}

{# Uncomment to customize specific blocks: #}
{# {% block page_icon %}<i class="bi bi-custom-icon text-neon fs-2 me-3"></i>{% endblock %} #}
{# {% block grid_view_item_template %}...custom grid layout...{% endblock %} #}
```

**When to customize:**
- Override `{% block page_icon %}` to change the icon
- Override `{% block grid_view_item_template %}` to customize grid cards
- Override `{% block list_view_item_template %}` to customize list items
- Override `{% block table_view_row_template %}` to customize table rows
- Add custom JavaScript controllers
- Add custom CSS classes

---

## How Controllers Use Templates

Controllers **ALWAYS** reference the **extension templates**, not the generated ones.

**Generated Controller Code:**
```php
// src/Controller/Generated/ContactControllerGenerated.php

protected function indexAction(): Response
{
    $this->denyAccessUnlessGranted(ContactVoter::LIST);

    return $this->render('contact/index.html.twig', [  // ✅ Extension template
        'entities' => [],
        'entity_name' => 'contact',
        // ... other variables
    ]);
}

protected function showAction(Contact $contact): Response
{
    $this->denyAccessUnlessGranted(ContactVoter::VIEW, $contact);

    return $this->render('contact/show.html.twig', [  // ✅ Extension template
        'contact' => $contact,
    ]);
}
```

**Template Resolution Chain:**
1. Controller calls `render('contact/index.html.twig')`
2. Twig loads `/templates/contact/index.html.twig` (extension)
3. Extension template extends `'contact/generated/index_generated.html.twig'`
4. Twig loads `/templates/contact/generated/index_generated.html.twig` (generated)
5. Final rendered output uses generated template with any overridden blocks from extension

---

## Template Types

### 1. Index Template (`index.html.twig`)

**Generated file:** `/templates/contact/generated/index_generated.html.twig`

**Purpose:** List page with Grid/List/Table views

**Extends:** `_base_entity_list.html.twig`

**Key Blocks:**
- `{% block page_icon %}` - Page icon in header
- `{% block grid_view_item_template %}` - Grid card layout
- `{% block list_view_item_template %}` - List row layout
- `{% block table_headers %}` - Table column headers
- `{% block table_view_row_template %}` - Table row layout

**Features:**
- Multi-view system (Grid, List, Table)
- Data-bind rendering (client-side)
- Search, filter, sort support
- Pagination
- Action dropdowns (View, Edit, Delete)

---

### 2. Show Template (`show.html.twig`)

**Generated file:** `/templates/contact/generated/show_generated.html.twig`

**Purpose:** Detail page displaying entity information

**Extends:** `base.html.twig`

**Key Blocks:**
- `{% block title %}` - Page title
- `{% block body %}` - Full page body
- Custom sections for each property group

**Features:**
- Bento Grid layout
- Property type formatting (dates, booleans, relationships)
- Null value handling
- Metadata section (created/updated dates)
- Action buttons (Edit, Delete, Back)

---

### 3. Form Template (`form.html.twig`)

**Generated file:** `/templates/contact/generated/form_generated.html.twig`

**Purpose:** Shared form template for create/edit

**Extends:** `base.html.twig`

**Key Blocks:**
- `{% block title %}` - Form title (Create vs Edit)
- `{% block body %}` - Form body

**Features:**
- `form-navigation` controller (Enter-as-Tab behavior)
- Auto field rendering from form type
- CSRF protection
- Validation error display
- Save/Cancel buttons

---

### 4. New Template (`new.html.twig`)

**Generated file:** `/templates/contact/generated/new_generated.html.twig`

**Purpose:** Wrapper for create page

**Includes:** Usually includes or extends the form template with `is_edit: false`

---

### 5. Edit Template (`edit.html.twig`)

**Generated file:** `/templates/contact/generated/edit_generated.html.twig`

**Purpose:** Wrapper for edit page

**Includes:** Usually includes or extends the form template with `is_edit: true`

---

## Customization Examples

### Example 1: Change Page Icon

**File:** `/templates/contact/index.html.twig`
```twig
{% extends 'contact/generated/index_generated.html.twig' %}

{% block page_icon %}
    <i class="bi bi-people-fill text-neon fs-2 me-3"></i>
{% endblock %}
```

---

### Example 2: Customize Grid Card Layout

**File:** `/templates/contact/index.html.twig`
```twig
{% extends 'contact/generated/index_generated.html.twig' %}

{% block grid_view_item_template %}
    <div class="col">
        <div class="luminai-card h-100 p-4 custom-card-style">
            {# Your custom grid layout here #}
            <h5 data-bind="fullName" data-bind-text></h5>
            <p data-bind="email" data-bind-text></p>
            {# Add custom badges, icons, etc. #}
        </div>
    </div>
{% endblock %}
```

---

### Example 3: Add Custom Section to Show Page

**File:** `/templates/contact/show.html.twig`
```twig
{% extends 'contact/generated/show_generated.html.twig' %}

{% block before_metadata %}
    <div class="bento-item">
        <div class="luminai-card p-4">
            <h5><i class="bi bi-star me-2"></i>VIP Information</h5>
            {% if contact.isVip %}
                <p>This is a VIP contact!</p>
                <p>VIP Level: {{ contact.vipLevel }}</p>
            {% else %}
                <p>Standard contact</p>
            {% endif %}
        </div>
    </div>
{% endblock %}
```

---

### Example 4: Customize Form Layout

**File:** `/templates/contact/form.html.twig`
```twig
{% extends 'contact/generated/form_generated.html.twig' %}

{% block body %}
    <div class="container py-4">
        <div class="row justify-content-center">
            <div class="col-md-10">
                <div class="luminai-card p-4">
                    <h2>Contact Information</h2>

                    {{ form_start(form, {
                        'attr': {
                            'data-turbo': 'true',
                            'data-controller': 'form-navigation'
                        }
                    }) }}

                    {# Custom two-column layout #}
                    <div class="row">
                        <div class="col-md-6">
                            {{ form_row(form.firstName) }}
                            {{ form_row(form.lastName) }}
                        </div>
                        <div class="col-md-6">
                            {{ form_row(form.email) }}
                            {{ form_row(form.phone) }}
                        </div>
                    </div>

                    {# Rest of fields #}
                    {% for child in form.children %}
                        {% if child.vars.name not in ['_token', 'firstName', 'lastName', 'email', 'phone'] %}
                            {{ form_row(child) }}
                        {% endif %}
                    {% endfor %}

                    <div class="mt-4">
                        <button type="submit" class="btn btn-primary">Save</button>
                        <a href="{{ path('contact_index') }}" class="btn btn-secondary">Cancel</a>
                    </div>

                    {{ form_end(form) }}
                </div>
            </div>
        </div>
    </div>
{% endblock %}
```

---

## Best Practices

### ✅ DO

1. **Always extend generated templates** - Use `{% extends 'entity/generated/type_generated.html.twig' %}`
2. **Customize by overriding blocks** - Override only the specific blocks you need
3. **Keep extension templates minimal** - Only include customizations
4. **Test after regeneration** - Ensure your customizations still work after running `genmax:generate`
5. **Use block structure** - Organize customizations into logical blocks

### ❌ DON'T

1. **Never edit generated templates** - Changes will be lost when regenerating
2. **Don't duplicate full implementation** - Extension templates should be minimal
3. **Don't break block inheritance** - Maintain the block structure from generated templates
4. **Don't include the full content** - Use `extends`, not copy-paste
5. **Don't modify controller template paths** - Controllers must reference extension templates

---

## Regeneration Workflow

When you run `php bin/console genmax:generate Contact`:

1. **Generated templates** are ALWAYS regenerated:
   - `/templates/contact/generated/index_generated.html.twig` ✅ Overwritten
   - `/templates/contact/generated/show_generated.html.twig` ✅ Overwritten
   - `/templates/contact/generated/form_generated.html.twig` ✅ Overwritten
   - `/templates/contact/generated/new_generated.html.twig` ✅ Overwritten
   - `/templates/contact/generated/edit_generated.html.twig` ✅ Overwritten

2. **Extension templates** are SKIPPED if they exist:
   - `/templates/contact/index.html.twig` ⏭️ Skipped (preserves customizations)
   - `/templates/contact/show.html.twig` ⏭️ Skipped (preserves customizations)
   - `/templates/contact/form.html.twig` ⏭️ Skipped (preserves customizations)
   - `/templates/contact/new.html.twig` ⏭️ Skipped (preserves customizations)
   - `/templates/contact/edit.html.twig` ⏭️ Skipped (preserves customizations)

3. **Your customizations are preserved** because they're in extension templates

---

## Common Issues and Solutions

### Issue 1: Templates not updating after regeneration

**Cause:** Editing generated templates instead of extension templates

**Solution:**
1. Copy your customizations from generated template
2. Delete the generated template
3. Run `genmax:generate` to regenerate clean generated template
4. Paste customizations into extension template (properly using block overrides)

---

### Issue 2: Changes being lost after regeneration

**Cause:** Editing files in `/templates/entity/generated/` folder

**Solution:**
- Only edit files in `/templates/entity/` folder (root level, not in `generated/` subfolder)
- Use `extends` to inherit from generated templates
- Override specific blocks for customizations

---

### Issue 3: Template inheritance not working

**Cause:** Using `{% include %}` instead of `{% extends %}`

**Solution:**
```twig
{# ❌ WRONG #}
{% include 'contact/generated/index_generated.html.twig' %}

{# ✅ CORRECT #}
{% extends 'contact/generated/index_generated.html.twig' %}
```

---

### Issue 4: Full content in extension templates

**Cause:** Old generation system or manual copying

**Solution:**
1. Delete the extension template: `rm app/templates/contact/index.html.twig`
2. Regenerate: `php bin/console genmax:generate Contact`
3. Extension template will be recreated with minimal `extends` pattern
4. Add customizations as needed by overriding blocks

---

## Migration from Old Structure

If your templates have the old structure (full content in extension templates):

```bash
# 1. Backup existing customizations
cp -r app/templates/contact app/templates/contact.backup

# 2. Delete extension templates (keep generated ones)
rm app/templates/contact/index.html.twig
rm app/templates/contact/show.html.twig
rm app/templates/contact/form.html.twig
rm app/templates/contact/new.html.twig
rm app/templates/contact/edit.html.twig

# 3. Regenerate with new pattern
docker-compose exec app php bin/console genmax:generate Contact

# 4. Review generated extension templates - they now use 'extends'
cat app/templates/contact/index.html.twig

# 5. If you had customizations, migrate them to block overrides
# Compare app/templates/contact.backup/ with new structure
# Move customizations to appropriate {% block %} overrides
```

---

## Summary

**Key Principle:** Extension templates should be **minimal wrappers** that extend generated templates, not full implementations.

**Folder Structure:**
- `/templates/{entity}/generated/` - Full implementation (always regenerated)
- `/templates/{entity}/` - Minimal extends (safe to customize)

**Controllers:** Always reference extension templates: `'contact/index.html.twig'`

**Customization:** Override specific blocks in extension templates

**Regeneration:** Generated templates overwritten, extension templates preserved

---

**For more information:**
- [Genmax Documentation](GENMAX.md)
- [Quick Start Guide](QUICK_START.md)
- [Template Generator Source](../../src/Service/Genmax/TemplateGenerator.php)
