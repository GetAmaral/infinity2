# API Platform 4 Configuration for DealStage
# This file is ALWAYS regenerated by Genmax. DO NOT edit manually.
# @generated by Genmax Code Generator

resources:
  App\Entity\DealStage:
    shortName: DealStage
    description: "Stages within sales pipelines"

    # DTO configuration - processor is set per-operation to avoid affecting DELETE
    output: App\Dto\DealStageOutputDto

    normalizationContext:
      groups: ["dealstage:read"]

    denormalizationContext:
      groups: ["dealstage:write"]

    order:
      createdAt: DESC

    security: "is_granted('ROLE_CRM_ADMIN')"

    operations:
      - class: ApiPlatform\Metadata\GetCollection
        security: "is_granted('ROLE_CRM_ADMIN')"
      - class: ApiPlatform\Metadata\Get
        security: "is_granted('ROLE_CRM_ADMIN')"
      - class: ApiPlatform\Metadata\Post
        input: App\Dto\DealStageInputDto
        processor: App\State\DealStageProcessor
        security: "is_granted('ROLE_CRM_ADMIN')"
      - class: ApiPlatform\Metadata\Put
        input: App\Dto\DealStageInputDto
        processor: App\State\DealStageProcessor
        security: "is_granted('ROLE_CRM_ADMIN')"
      - class: ApiPlatform\Metadata\Patch
        input: App\Dto\DealStageInputDto
        processor: App\State\DealStageProcessor
        security: "is_granted('ROLE_CRM_ADMIN')"
      - class: ApiPlatform\Metadata\Delete
        security: "is_granted('ROLE_CRM_ADMIN')"


    # Property-level configuration
    properties:
      organization:
        description: "Organization"
        example: "/api/organizations/01234567-89ab-cdef-0123-456789abcdef"
      stageName:
        writable: false
        description: "Denormalized stage name from PipelineStage for quick reference and reporting"
        example: "Qualification"
      probability:
        description: "Win probability percentage (0-100) for this stage. Based on historical data and stage definition."
        example: "60.00"
        # Advanced filters
        filters:
          - type: NumericFilter
      rottenDays:
        description: "Number of days allowed in this stage before deal is marked as rotten\/stale. NULL or 0 means no limit."
        example: "14"
        # Advanced filters
        filters:
          - type: NumericFilter
      rotten:
        writable: false
        description: "Indicates if deal has been in this stage too long (exceeded rottenDays threshold)"
        example: "false"
        # Advanced filters
        filters:
          - type: BooleanFilter
      enteredBy:
        writable: false
        description: "User who moved the deal into this stage"
        example: "\/api\/users\/0199cadd-1111-7c91-8b73-c726b6d7bbd0"
      exitedBy:
        writable: false
        description: "User who moved the deal out of this stage"
        example: "\/api\/users\/0199cadd-2222-7c91-8b73-c726b6d7bbd0"
      expectedCloseDate:
        description: "Forecasted close date for the deal when it was in this stage"
        example: "2025-11-15"
        # Advanced filters
        filters:
          - type: DateFilter
      stageValue:
        description: "Snapshot of the deal value when it entered this stage, used for pipeline reporting"
        example: "50000.00"
        # Advanced filters
        filters:
          - type: NumericFilter
      daysInStage:
        description: "Number of days the deal has been in this pipeline stage"
        example: "5.5"
      weightedValue:
        writable: false
        description: "Probability-weighted deal value (stageValue * probability\/100) for forecasting"
        example: "30000.00"
        # Advanced filters
        filters:
          - type: NumericFilter
      active:
        description: "Indicates if the deal is currently in this stage (true) or has moved on (false)"
        example: "true"
        # Advanced filters
        filters:
          - type: BooleanFilter
      deal:
        description: "The deal that this stage record belongs to"
        example: "\/api\/deals\/0199cadd-9abc-7c91-8b73-c726b6d7bbd0"
      endedAt:
        description: "Timestamp when the deal exited this pipeline stage"
        example: "2025-10-20T16:20:00Z"
      lastUpdatedAt:
        description: "Timestamp of the last update or activity in this stage"
        example: "2025-10-19T09:45:00Z"
      notes:
        description: "Notes and comments about this stage transition or current stage status"
        example: "Customer requested pricing for enterprise plan. Awaiting approval from finance."
      pipelineStage:
        description: "Reference to the pipeline stage configuration that defines this stage"
        example: "\/api\/pipeline_stages\/0199cadd-1234-7c91-8b73-c726b6d7bbd0"
      startedAt:
        description: "Timestamp when the deal entered this pipeline stage"
        example: "2025-10-15T14:30:00Z"
