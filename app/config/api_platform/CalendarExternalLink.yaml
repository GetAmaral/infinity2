# API Platform 4 Configuration for CalendarExternalLink
# This file is ALWAYS regenerated by Genmax. DO NOT edit manually.
# @generated by Genmax Code Generator

resources:
  App\Entity\CalendarExternalLink:
    shortName: CalendarExternalLink
    description: "Manages OAuth-based external calendar integrations (Google Calendar, Microsoft Outlook, Apple Calendar) with bi-directional sync, webhook support, and token refresh management"

    # DTO configuration - processor is set per-operation to avoid affecting DELETE
    output: App\Dto\CalendarExternalLinkOutputDto

    normalizationContext:
      groups: ["calendarexternallink:read"]

    denormalizationContext:
      groups: ["calendarexternallink:write"]

    order:
      createdAt: DESC

    security: "is_granted('ROLE_EVENT_ADMIN')"

    operations:
      - class: ApiPlatform\Metadata\GetCollection
        security: "is_granted('ROLE_EVENT_ADMIN')"
      - class: ApiPlatform\Metadata\Get
        security: "is_granted('ROLE_EVENT_ADMIN')"
      - class: ApiPlatform\Metadata\Post
        input: App\Dto\CalendarExternalLinkInputDto
        processor: App\State\CalendarExternalLinkProcessor
        security: "is_granted('ROLE_EVENT_ADMIN')"
      - class: ApiPlatform\Metadata\Put
        input: App\Dto\CalendarExternalLinkInputDto
        processor: App\State\CalendarExternalLinkProcessor
        security: "is_granted('ROLE_EVENT_ADMIN')"
      - class: ApiPlatform\Metadata\Patch
        input: App\Dto\CalendarExternalLinkInputDto
        processor: App\State\CalendarExternalLinkProcessor
        security: "is_granted('ROLE_EVENT_ADMIN')"
      - class: ApiPlatform\Metadata\Delete
        security: "is_granted('ROLE_EVENT_ADMIN')"


    # Property-level configuration
    properties:
      name:
        description: "The brand name"
        example: "Nike"
      calendars:
        description: "Collection of calendars linked to this external provider connection"
        example: "[{\"id\": \"0199...\", \"name\": \"Work Calendar\"}]"
      externalProvider:
        description: "External calendar provider type (Google Calendar, Microsoft Outlook, Apple iCloud)"
        example: "google_calendar"
      active:
        description: "Whether this external calendar connection is currently active and syncing"
        example: "true"
        # Advanced filters
        filters:
          - type: BooleanFilter
      externalId:
        description: "Unique identifier from external provider (e.g., Google user ID, Microsoft account email). Combined with provider and user for uniqueness."
        example: "user@gmail.com"
      url:
        description: "Public calendar URL or CalDAV endpoint (if applicable)"
        example: "https:\/\/calendar.google.com\/calendar\/ical\/user@example.com\/public\/basic.ics"
      accessToken:
        readable: false
        description: "OAuth 2.0 access token (encrypted at rest, never exposed in API responses)"
        example: "[ENCRYPTED]"
      refreshToken:
        readable: false
        description: "OAuth 2.0 refresh token for renewing access tokens (encrypted at rest)"
        example: "[ENCRYPTED]"
      tokenExpiresAt:
        writable: false
        description: "Timestamp when the current access token expires (used for automatic refresh)"
        example: "2025-10-19T14:30:00Z"
        # Advanced filters
        filters:
          - type: DateFilter
      syncToken:
        description: "Provider-specific sync token for incremental synchronization (Google sync token, Outlook delta link)"
        example: "CNDQxOTMxMjg3NjgzMDAwMA"
      lastSyncedAt:
        writable: false
        description: "Timestamp of the last successful synchronization with external provider"
        example: "2025-10-19T14:25:00Z"
        # Advanced filters
        filters:
          - type: DateFilter
      webhookUrl:
        writable: false
        description: "Webhook endpoint URL registered with external provider for real-time event notifications"
        example: "https:\/\/app.example.com\/webhooks\/calendar\/0199cadd-647a-75ac"
      webhookChannelId:
        writable: false
        description: "Provider-specific webhook channel identifier (Google channel ID, Microsoft subscription ID)"
        example: "uuid-channel-abc-123"
      webhookExpiresAt:
        writable: false
        description: "Timestamp when the webhook subscription expires (requires renewal)"
        example: "2025-10-26T14:30:00Z"
        # Advanced filters
        filters:
          - type: DateFilter
      syncDirection:
        description: "Synchronization direction: bidirectional, inbound_only (external -> internal), or outbound_only (internal -> external)"
        example: "bidirectional"
      lastErrorMessage:
        writable: false
        description: "Error message from the last failed sync attempt (null if last sync was successful)"
        example: "OAuth token expired. Re-authentication required."
      lastErrorAt:
        writable: false
        description: "Timestamp of the last error occurrence"
        example: "2025-10-19T13:45:00Z"
        # Advanced filters
        filters:
          - type: DateFilter
      syncIntervalMinutes:
        description: "Polling interval in minutes for periodic synchronization (15-1440). Webhooks are preferred for real-time sync."
        example: "15"
      retryCount:
        writable: false
        description: "Number of consecutive failed sync attempts (resets on successful sync)"
        example: 0
      scopes:
        description: "OAuth 2.0 scopes granted for this connection (e.g., calendar.readonly, calendar.events)"
        example: "[\"https:\/\/www.googleapis.com\/auth\/calendar\", \"https:\/\/www.googleapis.com\/auth\/calendar.events\"]"
      metadata:
        description: "Provider-specific metadata and configuration (timezone, color coding, calendar list, etc.)"
        example: "{\"timezone\": \"America\/New_York\", \"primary_calendar_id\": \"primary\", \"color\": \"#1E88E5\"}"
      user:
        description: "User who owns this external calendar connection"
        example: "{\"id\": \"0199...\", \"email\": \"user@example.com\"}"
